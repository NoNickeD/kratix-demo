---
# ExternalSecret to fetch GitHub PAT from AWS Secrets Manager
#
# Create the secret in AWS Secrets Manager:
#   aws secretsmanager create-secret \
#     --name kratix/git-credentials \
#     --secret-string '{"username":"username","password":"ghp_your_github_pat_here"}' \
#     --region eu-central-1
#
# The PAT needs 'repo' scope for read/write access
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: git-credentials
  namespace: kratix-platform-system
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore
  target:
    name: git-credentials
    creationPolicy: Owner
  data:
    - secretKey: username
      remoteRef:
        key: kratix/git-credentials
        property: username
    - secretKey: password
      remoteRef:
        key: kratix/git-credentials
        property: password
